From 242f332b776384c50b483a7bffbbbf48d598d27a Mon Sep 17 00:00:00 2001
From: ginkgoMZD <mzd@ginkgostreet.com>
Date: Wed, 23 Mar 2022 09:56:38 -0400
Subject: [PATCH] resolve TypeError: unsupported operand types: string + int;

---
 templates/CRM/Price/Form/LineItem.tpl | 3 ++-
 templates/CRM/Price/Page/LineItem.tpl | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/templates/CRM/Price/Form/LineItem.tpl b/templates/CRM/Price/Form/LineItem.tpl
index 7502e850ad2..e94853330ff 100644
--- a/templates/CRM/Price/Form/LineItem.tpl
+++ b/templates/CRM/Price/Form/LineItem.tpl
@@ -124,7 +124,8 @@
           {assign var="lineItemCount" value=0}
 
           {foreach from=$pcount item=p_count}
-            {assign var="lineItemCount" value=$lineItemCount+$p_count.participant_count}
+            {assign var="intPCount" value=$p_count.participant_count|intval}
+            {assign var="lineItemCount" value=$lineItemCount+$intPCount}
           {/foreach}
           {if $lineItemCount < 1 }
             {assign var="lineItemCount" value=1}

diff --git a/templates/CRM/Price/Page/LineItem.tpl b/templates/CRM/Price/Page/LineItem.tpl
index 7bac227eb9b..d2c55bebcb5 100644
--- a/templates/CRM/Price/Page/LineItem.tpl
+++ b/templates/CRM/Price/Page/LineItem.tpl
@@ -111,7 +111,8 @@
         {assign var="lineItemCount" value=0}
 
         {foreach from=$pcount item=p_count}
-          {assign var="lineItemCount" value=$lineItemCount+$p_count.participant_count}
+          {assign var="intPCount" value=$p_count.participant_count|intval}
+          {assign var="lineItemCount" value=$lineItemCount+$intPCount}
         {/foreach}
         {if $lineItemCount < 1 }
           {assign var="lineItemCount" value=1}

diff --git a/CRM/Contact/BAO/Group.php b/CRM/Contact/BAO/Group.php
index 0342416cff..112f38730e 100644
--- a/CRM/Contact/BAO/Group.php
+++ b/CRM/Contact/BAO/Group.php
@@ -999,7 +999,7 @@ class CRM_Contact_BAO_Group extends CRM_Contact_DAO_Group {
     // CRM-16905 - Sort by count cannot be done with sql
     if (!empty($params['sort']) && strpos($params['sort'], 'count') === 0) {
       usort($values, function($a, $b) {
-        return $a['count'] - $b['count'];
+        return (int)$a['count'] - $b['count'];
       });
       if (strpos($params['sort'], 'desc')) {
         $values = array_reverse($values, TRUE);

diff --git a/CRM/Price/BAO/LineItem.php b/CRM/Price/BAO/LineItem.php
index ab096b848d..b552711895 100644
--- a/CRM/Price/BAO/LineItem.php
+++ b/CRM/Price/BAO/LineItem.php
@@ -319,8 +319,8 @@ WHERE li.contribution_id = %1";
         'description' => $options[$oid]['description'] ?? NULL,
         'qty' => $qty,
         'unit_price' => $price,
-        'line_total' => $qty * $price,
-        'participant_count' => $qty * $participantsPerField,
+        'line_total' => (int)$qty * $price,
+        'participant_count' => (int)$qty * $participantsPerField,
         'max_value' => $options[$oid]['max_value'] ?? NULL,
         'membership_type_id' => $options[$oid]['membership_type_id'] ?? NULL,
         'membership_num_terms' => $options[$oid]['membership_num_terms'] ?? NULL,

