From 73d1c6e51dff3c2b55f7e612fb00a9191de5a6b9 Mon Sep 17 00:00:00 2001
From: ginkgoMZD <mzd@ginkgostreet.com>
Date: Mon, 28 Mar 2022 19:11:48 -0400
Subject: [PATCH 1/4] resolve "Failed to load about:blank, with network status
 code 301"

https://stackoverflow.com/questions/63119774/laravel-snappy-returning-failed-to-load-aboutblank-with-network-status-code-30
---
 CRM/Utils/PDF/Utils.php | 1 +
 1 file changed, 1 insertion(+)

diff --git a/CRM/Utils/PDF/Utils.php b/CRM/Utils/PDF/Utils.php
index a751baa1e38..cbb502e5812 100644
--- a/CRM/Utils/PDF/Utils.php
+++ b/CRM/Utils/PDF/Utils.php
@@ -220,6 +220,7 @@ public static function _html2pdf_wkhtmltopdf($paper_size, $orientation, $margins
     $snappy->setOption("margin-right", $margins[2] . $margins[0]);
     $snappy->setOption("margin-bottom", $margins[3] . $margins[0]);
     $snappy->setOption("margin-left", $margins[4] . $margins[0]);
+    $snappy->setOption('enable-local-file-access', true);
     $pdf = $snappy->getOutputFromHtml($html);
     if ($output) {
       return $pdf;

From e8a332e7c21bbf0436b9baf0faa9ad8af811462c Mon Sep 17 00:00:00 2001
From: ginkgoMZD <mzd@ginkgostreet.com>
Date: Mon, 28 Mar 2022 19:22:47 -0400
Subject: [PATCH 2/4] resolve build failure UpperCaseConstant;

---
 CRM/Utils/PDF/Utils.php | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/CRM/Utils/PDF/Utils.php b/CRM/Utils/PDF/Utils.php
index cbb502e5812..54c19621c90 100644
--- a/CRM/Utils/PDF/Utils.php
+++ b/CRM/Utils/PDF/Utils.php
@@ -220,7 +220,7 @@ public static function _html2pdf_wkhtmltopdf($paper_size, $orientation, $margins
     $snappy->setOption("margin-right", $margins[2] . $margins[0]);
     $snappy->setOption("margin-bottom", $margins[3] . $margins[0]);
     $snappy->setOption("margin-left", $margins[4] . $margins[0]);
-    $snappy->setOption('enable-local-file-access', true);
+    $snappy->setOption('enable-local-file-access', TRUE);
     $pdf = $snappy->getOutputFromHtml($html);
     if ($output) {
       return $pdf;

From 943e6386697d1e8564cb47a15cb4bc8acfebff51 Mon Sep 17 00:00:00 2001
From: ginkgoMZD <mzd@ginkgostreet.com>
Date: Mon, 16 May 2022 10:22:32 -0400
Subject: [PATCH 3/4] backwards-compatibility and comment;

---
 CRM/Utils/PDF/Utils.php | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/CRM/Utils/PDF/Utils.php b/CRM/Utils/PDF/Utils.php
index 54c19621c90..456130153f0 100644
--- a/CRM/Utils/PDF/Utils.php
+++ b/CRM/Utils/PDF/Utils.php
@@ -220,7 +220,14 @@ public static function _html2pdf_wkhtmltopdf($paper_size, $orientation, $margins
     $snappy->setOption("margin-right", $margins[2] . $margins[0]);
     $snappy->setOption("margin-bottom", $margins[3] . $margins[0]);
     $snappy->setOption("margin-left", $margins[4] . $margins[0]);
-    $snappy->setOption('enable-local-file-access', TRUE);
+    try {
+      // address https://github.com/mileszs/wicked_pdf/pull/920
+      $snappy->setOption('enable-local-file-access', TRUE);
+    } catch (\InvalidArgumentException $x) {
+      // must be wkhtmltopdf v <=0.12.5
+      // so, fine...
+    }
+    
     $pdf = $snappy->getOutputFromHtml($html);
     if ($output) {
       return $pdf;

From e1c817b580263881038153929ad416be089c49cd Mon Sep 17 00:00:00 2001
From: ginkgoMZD <mzd@ginkgostreet.com>
Date: Tue, 17 May 2022 11:51:09 -0400
Subject: [PATCH 4/4] resolve CheckStyle warnings;

---
 CRM/Utils/PDF/Utils.php | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/CRM/Utils/PDF/Utils.php b/CRM/Utils/PDF/Utils.php
index 456130153f0..883afefccb1 100644
--- a/CRM/Utils/PDF/Utils.php
+++ b/CRM/Utils/PDF/Utils.php
@@ -223,11 +223,12 @@ public static function _html2pdf_wkhtmltopdf($paper_size, $orientation, $margins
     try {
       // address https://github.com/mileszs/wicked_pdf/pull/920
       $snappy->setOption('enable-local-file-access', TRUE);
-    } catch (\InvalidArgumentException $x) {
+    }
+    catch (\InvalidArgumentException $x) {
       // must be wkhtmltopdf v <=0.12.5
       // so, fine...
     }
-    
+
     $pdf = $snappy->getOutputFromHtml($html);
     if ($output) {
       return $pdf;
